<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Login</title>
  <style>
    body {font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#f0f2f5;}
    .container {background:#fff; width:380px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,.1); overflow:hidden;}
    .tabs {display:flex;}
    .tab {flex:1; padding:14px; text-align:center; background:#eee; cursor:pointer;}
    .tab.active {background:#1877f2; color:white;}
    .form {padding:30px;}
    input, button {width:100%; padding:12px; margin:8px 0; border-radius:6px; border:1px solid #ddd; font-size:16px;}
    button {background:#1877f2; color:white; border:none; cursor:pointer;}
    button:hover {background:#166fe5;}
    .color-picker {display:flex; align-items:center; gap:10px;}
    #status {margin-top:10px; color:#d32f2f; text-align:center;}
  </style>
</head>
<body>
<div class="container">
  <div class="tabs">
    <div class="tab active" onclick="show('login')">Login</div>
    <div class="tab" onclick="show('register')">Register</div>
  </div>

  <!-- LOGIN FORM -->
  <div id="login" class="form">
    <h2>Login</h2>
    <input id="login-name" placeholder="Username" />
    <input id="login-pass" type="password" placeholder="Password" />
    <button onclick="login()">Enter Chat</button>
    <p id="status"></p>
  </div>

  <!-- REGISTER FORM -->
  <div id="register" class="form" style="display:none;">
    <h2>Register</h2>
    <input id="reg-name" placeholder="Choose username" />
    <input id="reg-pass" type="password" placeholder="Choose password" />
    <div class="color-picker">
      <label>Color:</label>
      <input id="reg-color" type="color" value="#3b82f6" />
    </div>
    <button onclick="register()">Create Account</button>
    <p id="reg-status"></p>
  </div>
</div>

<script>
function show(mode) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.form').forEach(f => f.style.display = 'none');
  document.querySelector(`.tab[onclick="show('${mode}')"]`).classList.add('active');
  document.getElementById(mode).style.display = 'block';
}

async function register() {
  const name = document.getElementById('reg-name').value.trim();
  const pass = document.getElementById('reg-pass').value;
  const color = document.getElementById('reg-color').value;
  const status = document.getElementById('reg-status');

  if (!name || !pass) return status.textContent = 'Fill all fields';

  const res = await fetch('/api/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, password: pass, color })
  });
  const data = await res.json();
  status.textContent = data.error || 'Registered! Now login â†’';
}

async function login() {
  const name = document.getElementById('login-name').value.trim();
  const pass = document.getElementById('login-pass').value;
  const status = document.getElementById('status');

  if (!name || !pass) return status.textContent = 'Enter username & password';

  const res = await fetch('/api/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, password: pass })
  });
  const data = await res.json();

  if (data.success) {
    // Store token in localStorage (no cookie dependency)
    localStorage.setItem('chatToken', data.token);
    localStorage.setItem('chatUser', JSON.stringify(data.user));
    location.href = '/index.html';
  } else {
    status.textContent = data.error;
  }
}
</script>
</body>
</html>